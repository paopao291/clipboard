<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <title>Sticker album</title>
        <link rel="stylesheet" href="style.css" />
    </head>
    <body>
        <!-- SVGフィルタ定義：シンプルな縁取り（Safari対応版） -->
        <svg style="position: absolute; width: 0; height: 0" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <filter id="outline-filter" x="-50%" y="-50%" width="200%" height="200%" color-interpolation-filters="sRGB">
                    <feMorphology
                        operator="dilate"
                        radius="12"
                        in="SourceAlpha"
                        result="dilated"
                    />
                    <feFlood flood-color="#ffffff" flood-opacity="1" result="white" />
                    <feComposite
                        in="white"
                        in2="dilated"
                        operator="in"
                        result="outline"
                    />
                    <feMerge>
                        <feMergeNode in="outline" />
                        <feMergeNode in="SourceGraphic" />
                    </feMerge>
                </filter>
            </defs>
        </svg>

        <div id="app">
            <!-- 隠しファイル入力 -->
            <input
                type="file"
                id="galleryInput"
                accept="image/*"
                style="display: none"
                multiple
            />
            <input
                type="file"
                id="cameraInput"
                accept="image/*"
                capture="environment"
                style="display: none"
            />
            <input
                type="file"
                id="backgroundInput"
                accept="image/*"
                style="display: none"
            />

            <!-- メインキャンバスエリア（全画面） -->
            <div id="canvas" class="canvas">
                <!-- 選択時のオーバーレイ -->
                <div id="selectionOverlay" class="selection-overlay"></div>

                <!-- スマホ用：長押しペーストエリア -->
                <textarea
                    id="pasteArea"
                    class="paste-area"
                    inputmode="none"
                ></textarea>

                <!-- 選択中のステッカー操作ボタン群 -->
                <div class="selection-buttons hidden">
                    <!-- 縁取りトグルボタン -->
                    <button id="borderBtn" class="selection-btn border-btn" title="縁取り">
                        <!-- 縁取り追加アイコン（縁取りなし状態で表示） -->
                        <svg class="border-icon-on" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M5 21C4.45 21 3.97917 20.8042 3.5875 20.4125C3.19583 20.0208 3 19.55 3 19V5C3 4.45 3.19583 3.97917 3.5875 3.5875C3.97917 3.19583 4.45 3 5 3H19C19.55 3 20.0208 3.19583 20.4125 3.5875C20.8042 3.97917 21 4.45 21 5V19C21 19.55 20.8042 20.0208 20.4125 20.4125C20.0208 20.8042 19.55 21 19 21H5ZM5 19H19V5H5V19Z" fill="currentColor"/>
                            <path d="M7 17V7H17V17H7Z" fill="currentColor"/>
                        </svg>
                        <!-- 縁取り削除アイコン（縁取りあり状態で表示） -->
                        <svg class="border-icon-off" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M7 17V7H17V17H7ZM5 19V21C4.45 21 3.97917 20.8042 3.5875 20.4125C3.19583 20.0208 3 19.55 3 19H5ZM3 17V15H5V17H3ZM3 13V11H5V13H3ZM3 9V7H5V9H3ZM5 5H3C3 4.45 3.19583 3.97917 3.5875 3.5875C3.97917 3.19583 4.45 3 5 3V5ZM7 21V19H9V21H7ZM7 5V3H9V5H7ZM11 21V19H13V21H11ZM11 5V3H13V5H11ZM15 21V19H17V21H15ZM15 5V3H17V5H15ZM19 21V19H21C21 19.55 20.8042 20.0208 20.4125 20.4125C20.0208 20.8042 19.55 21 19 21ZM19 17V15H21V17H19ZM19 13V11H21V13H19ZM19 9V7H21V9H19ZM19 5V3C19.55 3 20.0208 3.19583 20.4125 3.5875C20.8042 3.97917 21 4.45 21 5H19Z" fill="currentColor"/>
                        </svg>
                    </button>
                    
                    <!-- 最背面へボタン -->
                    <button id="sendToBackBtn" class="selection-btn send-to-back-btn" title="最背面へ">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
                            <path d="M160-501q0 71 47.5 122T326-322l-62-62 56-56 160 160-160 160-56-56 64-64q-105-6-176.5-81T80-500q0-109 75.5-184.5T340-760h140v80H340q-75 0-127.5 52T160-501Zm400 261v-80h320v80H560Zm0-220v-80h320v80H560Zm0-220v-80h320v80H560Z"/>
                        </svg>
                    </button>
                    
                    <!-- 固定ボタン -->
                    <button id="pinBtn" class="selection-btn pin-btn" title="固定">
                        <!-- アウトライン版（未固定時） -->
                        <svg class="pin-icon-outline" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
                            <path d="m640-480 80 80v80H520v240l-40 40-40-40v-240H240v-80l80-80v-280h-40v-80h400v80h-40v280Zm-286 80h252l-46-46v-314H400v314l-46 46Zm126 0Z"/>
                        </svg>
                        <!-- Fill版（固定時） -->
                        <svg class="pin-icon-fill" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
                            <path d="m640-480 80 80v80H520v240l-40 40-40-40v-240H240v-80l80-80v-280h-40v-80h400v80h-40v280Z"/>
                        </svg>
                    </button>
                </div>

                <!-- ゴミ箱ボタン -->
                <button id="trashBtn" class="trash-btn hidden" title="削除">
                    <svg xmlns="http://www.w3.org/2000/svg" height="22px" viewBox="0 -960 960 960" width="22px" fill="currentColor">
                        <path d="M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z"/>
                    </svg>
                    <div class="trash-tooltip">ドラッグして削除</div>
                </button>

                <!-- FAB（追加ボタン） -->
                <button id="addBtn" class="add-btn" title="画像を追加">
                    <svg xmlns="http://www.w3.org/2000/svg" height="28px" viewBox="0 -960 960 960" width="28px" fill="currentColor">
                        <path d="M440-440H200v-80h240v-240h80v240h240v80H520v240h-80v-240Z"/>
                    </svg>
                </button>

                <!-- 右上ボタン群 -->
                <div class="header-buttons">
                    <!-- 背景画像ボタン -->
                    <button id="backgroundBtn" class="header-btn background-btn" title="背景画像">
                        <!-- 背景なし時：通常の画像アイコン -->
                        <svg class="background-icon-add" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
                            <path d="M200-120q-33 0-56.5-23.5T120-200v-240h80v240h240v80H200Zm320 0v-80h240v-240h80v240q0 33-23.5 56.5T760-120H520ZM240-280l120-160 90 120 120-160 150 200H240ZM120-520v-240q0-33 23.5-56.5T200-840h240v80H200v240h-80Zm640 0v-240H520v-80h240q33 0 56.5 23.5T840-760v240h-80Zm-140-40q-26 0-43-17t-17-43q0-26 17-43t43-17q26 0 43 17t17 43q0 26-17 43t-43 17Z"/>
                        </svg>
                        <!-- 背景あり時：画像なしアイコン -->
                        <svg class="background-icon-remove" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
                            <path d="m840-234-80-80v-446H314l-80-80h526q33 0 56.5 23.5T840-760v526ZM792-56l-64-64H200q-33 0-56.5-23.5T120-200v-528l-64-64 56-56 736 736-56 56ZM240-280l120-160 90 120 33-44-283-283v447h447l-80-80H240Zm297-257ZM424-424Z"/>
                        </svg>
                    </button>
                    
                    <!-- 保存ボタン -->
                    <button id="saveBtn" class="header-btn save-btn" title="画像として保存">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
                            <path d="M480-320 280-520l56-58 104 104v-326h80v326l104-104 56 58-200 200ZM240-160q-33 0-56.5-23.5T160-240v-120h80v120h480v-120h80v120q0 33-23.5 56.5T720-160H240Z"/>
                        </svg>
                    </button>
                    
                    <!-- UI非表示ボタン -->
                    <button id="hideUIBtn" class="header-btn hide-ui-btn" title="UIを非表示">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
                            <path d="m177-120-57-57 184-183H200v-80h240v240h-80v-104L177-120Zm343-400v-240h80v104l183-184 57 57-184 183h104v80H520Z"/>
                        </svg>
                    </button>

                    <!-- インフォボタン -->
                    <button id="infoBtn" class="header-btn info-btn" title="操作方法">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
                            <path d="M478-240q21 0 35.5-14.5T528-290q0-21-14.5-35.5T478-340q-21 0-35.5 14.5T428-290q0 21 14.5 35.5T478-240Zm-36-154h74q0-33 7.5-52t42.5-52q26-26 41-49.5t15-56.5q0-56-41-86t-97-30q-57 0-92.5 30T342-618l66 26q5-18 22.5-39t53.5-21q32 0 48 17.5t16 38.5q0 20-12 37.5T506-526q-44 39-54 59t-10 73Zm38 314q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/>
                        </svg>
                    </button>
                </div>

                <!-- 左下ボタン群 -->
                <div class="footer-buttons">
                    <!-- 物理モード切り替えボタン -->
                    <button id="physicsBtn" class="footer-btn physics-btn" title="物理モード">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
                            <path d="M449-539q21 0 35.5-14.5T499-589q0-21-14.5-35.5T449-639q-21 0-35.5 14.5T399-589q0 21 14.5 35.5T449-539ZM822-80q-42 0-113-35t-152-95q-19 5-38.5 7.5T479-200q-117 0-198-81t-81-198q0-20 3-40t8-39q-59-81-94.5-151.5T81-822q0-27 15-42.5t41-15.5q26 0 67.5 18T319-801q-21 11-39 23t-35 26q-19-11-37-19t-38-17q18 38 38.5 74t43.5 71q38-54 97-85t130-31q117 0 198.5 81.5T759-479q0 71-31.5 130T642-252q35 23 71.5 44t74.5 38q-8-19-16.5-37T752-244q15-17 27-36t22-39q46 78 62.5 116.5T880-138q0 29-16 43.5T822-80ZM549-359q17 0 28.5-11.5T589-399q0-17-11.5-28.5T549-439q-17 0-28.5 11.5T509-399q0 17 11.5 28.5T549-359Zm50-140q13 0 21.5-8.5T629-529q0-13-8.5-21.5T599-559q-13 0-21.5 8.5T569-529q0 13 8.5 21.5T599-499ZM468-281q-51-44-98-91t-90-98q2 38 17 71.5t41 59.5q26 26 59 41t71 17Zm103-21q48-25 78-72.5T679-480q0-83-58.5-141T479-679q-58 0-105 30t-72 78q57 76 125 144t144 125Zm-197-73Zm117-116Z"/>
                        </svg>
                    </button>

                    <!-- 自動レイアウトボタン -->
                    <button id="layoutBtn" class="footer-btn layout-btn" title="自動レイアウト">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
                            <path d="m176-120-56-56 301-302-181-45 198-123-17-234 179 151 216-88-87 217 151 178-234-16-124 198-45-181-301 301Zm24-520-80-80 80-80 80 80-80 80Zm355 197 48-79 93 7-60-71 35-86-86 35-71-59 7 92-79 49 90 22 23 90Zm165 323-80-80 80-80 80 80-80 80ZM569-570Z"/>
                        </svg>
                    </button>
                </div>

                <!-- ヘルプステッカー用テンプレート（非表示） -->
                <template id="helpStickerTemplate">
                    <div class="help-sticker-content">
                        <h2>操作方法</h2>

                        <div class="help-section desktop-hint">
                            <h3>画像を追加</h3>
                            <p>
                                画像をコピーして <kbd>Ctrl+V</kbd> /
                                <kbd>Cmd+V</kbd><br>
                                または右下の <strong>+</strong> ボタンからファイルを選択
                            </p>

                            <h3>移動</h3>
                            <p>画像をドラッグ</p>

                            <h3>拡大縮小</h3>
                            <p>画像の上でマウスホイールをスクロール</p>

                            <h3>回転</h3>
                            <p><kbd>Shift</kbd> を押しながらドラッグ</p>

                            <h3>削除</h3>
                            <p>画像をドラッグして画面下のゴミ箱へ<br>
                            <small>（このステッカーも削除できます！）</small></p>
                        </div>

                        <div class="help-section mobile-hint">
                            <h3>画像を追加</h3>
                            <p>画像をコピーして画面を長押し→「ペースト」<br>
                            または右下の <strong>+</strong> ボタンからファイルを選択</p>

                            <h3>移動</h3>
                            <p>1本指でドラッグ</p>

                            <h3>拡大縮小・回転</h3>
                            <p>2本指でピンチ</p>

                            <h3>削除</h3>
                            <p>画像をドラッグして画面下のゴミ箱へ<br>
                            <small>（このステッカーも削除できます！）</small></p>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- Matter.js物理エンジン -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
        <!-- html2canvas（画像保存用） -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
        <script type="module" src="src/main.js"></script>
    </body>
</html>
