<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <title>Sticker album</title>
        <link rel="stylesheet" href="style.css" />
    </head>
    <body>
        <!-- SVGフィルタ定義：シンプルな縁取り -->
        <svg style="position: absolute; width: 0; height: 0">
            <defs>
                <filter id="outline-filter" color-interpolation-filters="sRGB">
                    <feMorphology
                        operator="dilate"
                        radius="12"
                        in="SourceAlpha"
                        result="dilated"
                    />
                    <feFlood flood-color="white" result="white" />
                    <feComposite
                        in="white"
                        in2="dilated"
                        operator="in"
                        result="outline"
                    />
                    <feMerge>
                        <feMergeNode in="outline" />
                        <feMergeNode in="SourceGraphic" />
                    </feMerge>
                </filter>
            </defs>
        </svg>

        <div id="app">
            <!-- 隠しファイル入力 -->
            <input
                type="file"
                id="galleryInput"
                accept="image/*"
                style="display: none"
                multiple
            />
            <input
                type="file"
                id="cameraInput"
                accept="image/*"
                capture="environment"
                style="display: none"
            />

            <!-- メインキャンバスエリア（全画面） -->
            <div id="canvas" class="canvas">
                <!-- 選択時のオーバーレイ -->
                <div id="selectionOverlay" class="selection-overlay"></div>

                <!-- スマホ用：長押しペーストエリア -->
                <textarea
                    id="pasteArea"
                    class="paste-area"
                    inputmode="none"
                ></textarea>

                <!-- 選択中のステッカー操作ボタン群 -->
                <div class="selection-buttons">
                    <!-- 最背面へボタン -->
                    <button id="sendToBackBtn" class="send-to-back-btn hidden" title="最背面へ">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
                            <path d="M160-501q0 71 47.5 122T326-322l-62-62 56-56 160 160-160 160-56-56 64-64q-105-6-176.5-81T80-500q0-109 75.5-184.5T340-760h140v80H340q-75 0-127.5 52T160-501Zm400 261v-80h320v80H560Zm0-220v-80h320v80H560Zm0-220v-80h320v80H560Z"/>
                        </svg>
                    </button>
                    
                    <!-- 固定ボタン -->
                    <button id="pinBtn" class="pin-btn hidden" title="固定">
                        <!-- アウトライン版（未固定時） -->
                        <svg class="pin-icon-outline" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
                            <path d="m640-480 80 80v80H520v240l-40 40-40-40v-240H240v-80l80-80v-280h-40v-80h400v80h-40v280Zm-286 80h252l-46-46v-314H400v314l-46 46Zm126 0Z"/>
                        </svg>
                        <!-- Fill版（固定時） -->
                        <svg class="pin-icon-fill" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
                            <path d="m640-480 80 80v80H520v240l-40 40-40-40v-240H240v-80l80-80v-280h-40v-80h400v80h-40v280Z"/>
                        </svg>
                    </button>
                </div>

                <!-- ゴミ箱ボタン -->
                <button id="trashBtn" class="trash-btn hidden" title="削除">
                    <svg
                        class="trash-icon"
                        width="22"
                        height="22"
                        viewBox="0 0 24 24"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                    >
                        <path
                            d="M3 6H21M19 6V20C19 21 18 22 17 22H7C6 22 5 21 5 20V6M8 6V4C8 3 9 2 10 2H14C15 2 16 3 16 4V6"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                        />
                        <path
                            d="M10 11V17M14 11V17"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                        />
                    </svg>
                    <div class="trash-tooltip">ドラッグして削除</div>
                </button>

                <!-- FAB（追加ボタン） -->
                <button id="addBtn" class="add-btn" title="画像を追加">
                    <svg
                        width="28"
                        height="28"
                        viewBox="0 0 24 24"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                    >
                        <path
                            d="M12 5V19M5 12H19"
                            stroke="currentColor"
                            stroke-width="2.5"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                        />
                    </svg>
                </button>

                <!-- 右上ボタン群 -->
                <div class="header-buttons">
                    <!-- UI非表示ボタン -->
                    <button id="hideUIBtn" class="hide-ui-btn" title="UIを非表示">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
                            <path d="m177-120-57-57 184-183H200v-80h240v240h-80v-104L177-120Zm343-400v-240h80v104l183-184 57 57-184 183h104v80H520Z"/>
                        </svg>
                    </button>

                    <!-- インフォボタン -->
                    <button id="infoBtn" class="info-btn" title="操作方法">
                        <svg
                            width="22"
                            height="22"
                            viewBox="0 0 22 22"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                        >
                            <circle
                                cx="11"
                                cy="11"
                                r="10"
                                stroke="currentColor"
                                stroke-width="1.5"
                            />
                            <path
                                d="M11 15.5V10.5M11 7V6.5"
                                stroke="currentColor"
                                stroke-width="2.5"
                                stroke-linecap="round"
                            />
                        </svg>
                    </button>
                </div>

                <!-- 左下ボタン群 -->
                <div class="footer-buttons">
                    <!-- 物理モード切り替えボタン -->
                    <button id="physicsBtn" class="physics-btn" title="物理モード">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
                            <path d="M449-539q21 0 35.5-14.5T499-589q0-21-14.5-35.5T449-639q-21 0-35.5 14.5T399-589q0 21 14.5 35.5T449-539ZM822-80q-42 0-113-35t-152-95q-19 5-38.5 7.5T479-200q-117 0-198-81t-81-198q0-20 3-40t8-39q-59-81-94.5-151.5T81-822q0-27 15-42.5t41-15.5q26 0 67.5 18T319-801q-21 11-39 23t-35 26q-19-11-37-19t-38-17q18 38 38.5 74t43.5 71q38-54 97-85t130-31q117 0 198.5 81.5T759-479q0 71-31.5 130T642-252q35 23 71.5 44t74.5 38q-8-19-16.5-37T752-244q15-17 27-36t22-39q46 78 62.5 116.5T880-138q0 29-16 43.5T822-80ZM549-359q17 0 28.5-11.5T589-399q0-17-11.5-28.5T549-439q-17 0-28.5 11.5T509-399q0 17 11.5 28.5T549-359Zm50-140q13 0 21.5-8.5T629-529q0-13-8.5-21.5T599-559q-13 0-21.5 8.5T569-529q0 13 8.5 21.5T599-499ZM468-281q-51-44-98-91t-90-98q2 38 17 71.5t41 59.5q26 26 59 41t71 17Zm103-21q48-25 78-72.5T679-480q0-83-58.5-141T479-679q-58 0-105 30t-72 78q57 76 125 144t144 125Zm-197-73Zm117-116Z"/>
                        </svg>
                    </button>

                    <!-- 自動レイアウトボタン -->
                    <button id="layoutBtn" class="layout-btn" title="自動レイアウト">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
                            <path d="m176-120-56-56 301-302-181-45 198-123-17-234 179 151 216-88-87 217 151 178-234-16-124 198-45-181-301 301Zm24-520-80-80 80-80 80 80-80 80Zm355 197 48-79 93 7-60-71 35-86-86 35-71-59 7 92-79 49 90 22 23 90Zm165 323-80-80 80-80 80 80-80 80ZM569-570Z"/>
                        </svg>
                    </button>
                </div>

                <!-- ヘルプステッカー用テンプレート（非表示） -->
                <template id="helpStickerTemplate">
                    <div class="help-sticker-content">
                        <h2>操作方法</h2>

                        <div class="help-section desktop-hint">
                            <h3>画像を追加</h3>
                            <p>
                                画像をコピーして <kbd>Ctrl+V</kbd> /
                                <kbd>Cmd+V</kbd><br>
                                または右下の <strong>+</strong> ボタンからファイルを選択
                            </p>

                            <h3>移動</h3>
                            <p>画像をドラッグ</p>

                            <h3>拡大縮小</h3>
                            <p>画像の上でマウスホイールをスクロール</p>

                            <h3>回転</h3>
                            <p><kbd>Shift</kbd> を押しながらドラッグ</p>

                            <h3>削除</h3>
                            <p>画像をドラッグして画面下のゴミ箱へ<br>
                            <small>（このステッカーも削除できます！）</small></p>
                        </div>

                        <div class="help-section mobile-hint">
                            <h3>画像を追加</h3>
                            <p>画像をコピーして画面を長押し→「ペースト」<br>
                            または右下の <strong>+</strong> ボタンからファイルを選択</p>

                            <h3>移動</h3>
                            <p>1本指でドラッグ</p>

                            <h3>拡大縮小・回転</h3>
                            <p>2本指でピンチ</p>

                            <h3>削除</h3>
                            <p>画像をドラッグして画面下のゴミ箱へ<br>
                            <small>（このステッカーも削除できます！）</small></p>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- Matter.js物理エンジン -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
        <script type="module" src="src/main.js"></script>
    </body>
</html>
